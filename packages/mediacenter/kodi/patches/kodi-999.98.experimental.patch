From 7f5982d15c9beb0733daa45c64690a11e3c6a405 Mon Sep 17 00:00:00 2001
From: peak3d <pfau@peak3d.de>
Date: Fri, 3 Mar 2017 11:10:24 +0100
Subject: [PATCH] Remove DemuxStream::bandwidth because its duplicate to
 bitrate / display it in video dialog if valid

---
 .../kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h | 1 -
 xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemux.h                    | 2 --
 xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp            | 2 +-
 xbmc/cores/VideoPlayer/DVDInputStreams/InputStreamAddon.cpp      | 1 -
 xbmc/cores/VideoPlayer/VideoPlayer.cpp                           | 2 ++
 xbmc/video/dialogs/GUIDialogVideoSettings.cpp                    | 9 +++++++--
 6 files changed, 10 insertions(+), 7 deletions(-)

diff --git a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
index e820c1d..cfad24d 100644
--- a/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
+++ b/xbmc/addons/kodi-addon-dev-kit/include/kodi/addon-instance/Inputstream.h
@@ -120,7 +120,6 @@ extern "C"
     char m_codecInternalName[32];        /*!< @brief (optional) internal name of codec (selectionstream info) */
     kodi::addon::CODEC_PROFILE m_codecProfile; /*!< @brief (optional) bandwidth of the stream (selectionstream info) */
     unsigned int m_pID;                  /*!< @brief (required) physical index */
-    unsigned int m_Bandwidth;            /*!< @brief (optional) bandwidth of the stream (selectionstream info) */
 
     const uint8_t *m_ExtraData;
     unsigned int m_ExtraSize;
diff --git a/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemux.h b/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemux.h
index b029437..81b5983 100644
--- a/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemux.h
+++ b/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemux.h
@@ -96,7 +96,6 @@ class CDemuxStream
     changes = 0;
     flags = FLAG_NONE;
     realtime = false;
-    bandwidth = 0;
   }
 
   virtual ~CDemuxStream()
@@ -116,7 +115,6 @@ class CDemuxStream
   StreamType type;
   int source;
   bool realtime;
-  unsigned int bandwidth;
 
   int iDuration; // in mseconds
   void* pPrivate; // private pointer for the demuxer
diff --git a/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp b/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp
index 3e7d994..e3f1af5 100644
--- a/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp
+++ b/xbmc/cores/VideoPlayer/DVDDemuxers/DVDDemuxClient.cpp
@@ -421,6 +421,7 @@ void CDVDDemuxClient::RequestStreams()
       streamVideo->iHeight         = source->iHeight;
       streamVideo->iWidth          = source->iWidth;
       streamVideo->fAspect         = source->fAspect;
+      streamVideo->iBitRate = source->iBitRate;
       streamVideo->stereo_mode     = "mono";
       if (source->ExtraSize > 0 && source->ExtraData)
       {
@@ -523,7 +524,6 @@ void CDVDDemuxClient::RequestStreams()
     dStream->uniqueId = stream->uniqueId;
     dStream->codec = stream->codec;
     dStream->codecName = stream->codecName;
-    dStream->bandwidth = stream->bandwidth;
     dStream->uniqueId = stream->uniqueId;
     dStream->cryptoSession = stream->cryptoSession;
     dStream->externalInterfaces = stream->externalInterfaces;
diff --git a/xbmc/cores/VideoPlayer/DVDInputStreams/InputStreamAddon.cpp b/xbmc/cores/VideoPlayer/DVDInputStreams/InputStreamAddon.cpp
index a3ee7d6..562399a 100644
--- a/xbmc/cores/VideoPlayer/DVDInputStreams/InputStreamAddon.cpp
+++ b/xbmc/cores/VideoPlayer/DVDInputStreams/InputStreamAddon.cpp
@@ -472,7 +472,6 @@ void CInputStreamAddon::UpdateStreams()
       continue;
 
     demuxStream->codec = codec->id;
-    demuxStream->bandwidth = stream.m_Bandwidth;
     demuxStream->codecName = stream.m_codecInternalName;
     demuxStream->uniqueId = streamIDs.m_streamIds[i];
     demuxStream->language[0] = stream.m_language[0];
diff --git a/xbmc/cores/VideoPlayer/VideoPlayer.cpp b/xbmc/cores/VideoPlayer/VideoPlayer.cpp
index f54a06e..4f8eaff 100644
--- a/xbmc/cores/VideoPlayer/VideoPlayer.cpp
+++ b/xbmc/cores/VideoPlayer/VideoPlayer.cpp
@@ -3357,12 +3357,14 @@ void CVideoPlayer::UpdateStreamInfos()
           SelectionStream& select = m_SelectionStreams.Get(STREAM_VIDEO, i);
           select.width = static_cast<CDemuxStreamVideo*>(stream)->iWidth;
           select.height = static_cast<CDemuxStreamVideo*>(stream)->iHeight;
+          select.bitrate = static_cast<CDemuxStreamVideo*>(stream)->iBitRate;
         }
       }
       else
       {
         s.width = static_cast<CDemuxStreamVideo*>(stream)->iWidth;
         s.height = static_cast<CDemuxStreamVideo*>(stream)->iHeight;
+        s.bitrate = static_cast<CDemuxStreamVideo*>(stream)->iBitRate;
       }
       s.stereo_mode = m_VideoPlayerVideo->GetStereoMode();
       if (s.stereo_mode == "mono")
diff --git a/xbmc/video/dialogs/GUIDialogVideoSettings.cpp b/xbmc/video/dialogs/GUIDialogVideoSettings.cpp
index 7f10c52..235a11e 100644
--- a/xbmc/video/dialogs/GUIDialogVideoSettings.cpp
+++ b/xbmc/video/dialogs/GUIDialogVideoSettings.cpp
@@ -409,9 +409,14 @@ void CGUIDialogVideoSettings::VideoStreamsOptionFiller(const CSetting *setting,
     }
 
     if (info.videoCodecName.empty())
-      strItem += StringUtils::Format(" (%ix%i)", info.width, info.height);
+      strItem += StringUtils::Format(" (%ix%i", info.width, info.height);
     else
-      strItem += StringUtils::Format(" (%s, %ix%i)", info.videoCodecName.c_str(), info.width, info.height);
+      strItem += StringUtils::Format(" (%s, %ix%i", info.videoCodecName.c_str(), info.width, info.height);
+
+    if (info.bitrate)
+      strItem += StringUtils::Format(", %i bps)", info.bitrate);
+    else
+      strItem += ")";
 
     strItem += StringUtils::Format(" (%i/%i)", i + 1, videoStreamCount);
     list.push_back(make_pair(strItem, i));
